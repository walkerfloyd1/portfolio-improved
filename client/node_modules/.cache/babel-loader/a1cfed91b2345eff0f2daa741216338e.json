{"ast":null,"code":"// Load modules\nvar Utils = require('./utils'); // Declare internals\n\n\nvar internals = {\n  delimiter: '&',\n  arrayPrefixGenerators: {\n    brackets: function (prefix, key) {\n      return prefix + '[]';\n    },\n    indices: function (prefix, key) {\n      return prefix + '[' + key + ']';\n    },\n    repeat: function (prefix, key) {\n      return prefix;\n    }\n  },\n  strictNullHandling: false,\n  skipNulls: false,\n  encode: true\n};\n\ninternals.stringify = function (obj, prefix, generateArrayPrefix, strictNullHandling, skipNulls, encode, filter) {\n  if (typeof filter === 'function') {\n    obj = filter(prefix, obj);\n  } else if (Utils.isBuffer(obj)) {\n    obj = obj.toString();\n  } else if (obj instanceof Date) {\n    obj = obj.toISOString();\n  } else if (obj === null) {\n    if (strictNullHandling) {\n      return encode ? Utils.encode(prefix) : prefix;\n    }\n\n    obj = '';\n  }\n\n  if (typeof obj === 'string' || typeof obj === 'number' || typeof obj === 'boolean') {\n    if (encode) {\n      return [Utils.encode(prefix) + '=' + Utils.encode(obj)];\n    }\n\n    return [prefix + '=' + obj];\n  }\n\n  var values = [];\n\n  if (typeof obj === 'undefined') {\n    return values;\n  }\n\n  var objKeys = Array.isArray(filter) ? filter : Object.keys(obj);\n\n  for (var i = 0, il = objKeys.length; i < il; ++i) {\n    var key = objKeys[i];\n\n    if (skipNulls && obj[key] === null) {\n      continue;\n    }\n\n    if (Array.isArray(obj)) {\n      values = values.concat(internals.stringify(obj[key], generateArrayPrefix(prefix, key), generateArrayPrefix, strictNullHandling, skipNulls, encode, filter));\n    } else {\n      values = values.concat(internals.stringify(obj[key], prefix + '[' + key + ']', generateArrayPrefix, strictNullHandling, skipNulls, encode, filter));\n    }\n  }\n\n  return values;\n};\n\nmodule.exports = function (obj, options) {\n  options = options || {};\n  var delimiter = typeof options.delimiter === 'undefined' ? internals.delimiter : options.delimiter;\n  var strictNullHandling = typeof options.strictNullHandling === 'boolean' ? options.strictNullHandling : internals.strictNullHandling;\n  var skipNulls = typeof options.skipNulls === 'boolean' ? options.skipNulls : internals.skipNulls;\n  var encode = typeof options.encode === 'boolean' ? options.encode : internals.encode;\n  var objKeys;\n  var filter;\n\n  if (typeof options.filter === 'function') {\n    filter = options.filter;\n    obj = filter('', obj);\n  } else if (Array.isArray(options.filter)) {\n    objKeys = filter = options.filter;\n  }\n\n  var keys = [];\n\n  if (typeof obj !== 'object' || obj === null) {\n    return '';\n  }\n\n  var arrayFormat;\n\n  if (options.arrayFormat in internals.arrayPrefixGenerators) {\n    arrayFormat = options.arrayFormat;\n  } else if ('indices' in options) {\n    arrayFormat = options.indices ? 'indices' : 'repeat';\n  } else {\n    arrayFormat = 'indices';\n  }\n\n  var generateArrayPrefix = internals.arrayPrefixGenerators[arrayFormat];\n\n  if (!objKeys) {\n    objKeys = Object.keys(obj);\n  }\n\n  for (var i = 0, il = objKeys.length; i < il; ++i) {\n    var key = objKeys[i];\n\n    if (skipNulls && obj[key] === null) {\n      continue;\n    }\n\n    keys = keys.concat(internals.stringify(obj[key], key, generateArrayPrefix, strictNullHandling, skipNulls, encode, filter));\n  }\n\n  return keys.join(delimiter);\n};","map":null,"metadata":{},"sourceType":"script"}